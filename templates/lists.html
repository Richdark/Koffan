{{define "lists"}}
<div x-data="listsPage()" x-init="init()" class="min-h-screen pb-24 bg-stone-50">
    <!-- Header -->
    <header class="sticky top-0 z-30 bg-stone-50 pt-3">
        <div class="container mx-auto max-w-4xl px-4">
            <div class="flex items-center gap-3 h-14 mb-4">
                <a href="/" class="p-2 text-stone-400 hover:text-stone-600 rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                </a>
                <h1 class="text-lg font-semibold text-stone-800" x-text="t('lists.title')">Listy zakupów</h1>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 max-w-4xl">
        <!-- Add new list form -->
        <div class="bg-white rounded-2xl border border-stone-200 p-5 mb-6">
            <form
                hx-post="/lists"
                hx-target="#lists-container"
                hx-swap="beforeend"
                hx-on::after-request="this.reset()"
                class="flex items-center gap-3"
            >
                <input
                    type="text"
                    name="name"
                    :placeholder="t('lists.new_list')"
                    placeholder="Nazwa nowej listy..."
                    required
                    class="flex-1 border border-stone-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent placeholder:text-stone-400"
                >
                <button
                    type="submit"
                    class="bg-pink-400 hover:bg-pink-500 text-white px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
                    x-text="t('common.add')"
                >Dodaj</button>
            </form>
        </div>

        <!-- Lists container -->
        <div id="lists-container" class="space-y-3">
            {{range .Lists}}
            {{template "partials/list_item" dict "List" . "ActiveList" $.ActiveList}}
            {{end}}
        </div>

        <!-- Empty State -->
        {{if not .Lists}}
        <div class="text-center py-20">
            <div class="w-16 h-16 mx-auto mb-4 bg-stone-100 rounded-2xl flex items-center justify-center">
                <svg class="w-8 h-8 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
            </div>
            <p class="text-stone-600 font-medium" x-text="t('lists.no_lists')">Brak list</p>
            <p class="text-sm text-stone-400 mt-1" x-text="t('lists.add_first_list')">Dodaj pierwszą listę zakupów</p>
        </div>
        {{end}}

        <!-- Templates Section -->
        <div class="mt-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-stone-800" x-text="t('templates.title')">Szablony</h2>
                <button
                    @click="showCreateTemplate = true"
                    class="text-sm text-pink-500 hover:text-pink-600 font-medium transition-colors"
                    x-text="t('templates.new_template')"
                >Nowy szablon</button>
            </div>

            <div id="templates-container" hx-get="/templates" hx-trigger="load" hx-swap="innerHTML">
                <div class="text-center py-8">
                    <div class="animate-spin w-6 h-6 border-2 border-pink-400 border-t-transparent rounded-full mx-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Template Modal -->
    <div
        x-show="showCreateTemplate"
        x-cloak
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div
            @click.outside="showCreateTemplate = false"
            class="bg-white rounded-2xl w-full max-w-md shadow-xl"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
        >
            <div class="p-6">
                <h3 class="text-lg font-semibold text-stone-800 mb-4" x-text="t('templates.new_template')">Nowy szablon</h3>
                <form
                    hx-post="/templates"
                    hx-target="#templates-container"
                    hx-swap="beforeend"
                    hx-on::after-request="this.reset(); showCreateTemplate = false"
                >
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-1" x-text="t('common.name')">Nazwa</label>
                            <input
                                type="text"
                                name="name"
                                required
                                class="w-full border border-stone-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                            >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-1" x-text="t('common.description')">Opis</label>
                            <input
                                type="text"
                                name="description"
                                class="w-full border border-stone-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                            >
                        </div>
                    </div>
                    <div class="flex justify-end gap-3 mt-6">
                        <button
                            type="button"
                            @click="showCreateTemplate = false"
                            class="px-4 py-2 text-sm text-stone-600 hover:text-stone-800 transition-colors"
                            x-text="t('common.cancel')"
                        >Anuluj</button>
                        <button
                            type="submit"
                            class="bg-pink-400 hover:bg-pink-500 text-white px-5 py-2 rounded-lg text-sm font-medium transition-colors"
                            x-text="t('common.create')"
                        >Utwórz</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Template from List Modal -->
    <div
        x-show="showCreateFromList"
        x-cloak
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div
            @click.outside="showCreateFromList = false"
            class="bg-white rounded-2xl w-full max-w-md shadow-xl"
        >
            <div class="p-6">
                <h3 class="text-lg font-semibold text-stone-800 mb-4" x-text="t('templates.create_from_list')">Utwórz szablon z listy</h3>
                <form
                    hx-post="/templates/from-list"
                    hx-target="#templates-container"
                    hx-swap="beforeend"
                    hx-on::after-request="this.reset(); showCreateFromList = false"
                >
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-1" x-text="t('common.name')">Nazwa szablonu</label>
                            <input
                                type="text"
                                name="name"
                                required
                                class="w-full border border-stone-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                            >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-1" x-text="t('common.description')">Opis</label>
                            <input
                                type="text"
                                name="description"
                                class="w-full border border-stone-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                            >
                        </div>
                    </div>
                    <p class="text-xs text-stone-400 mt-4" x-text="t('templates.from_list_hint')">Szablon zostanie utworzony z niezakupionych produktów aktywnej listy.</p>
                    <div class="flex justify-end gap-3 mt-6">
                        <button
                            type="button"
                            @click="showCreateFromList = false"
                            class="px-4 py-2 text-sm text-stone-600 hover:text-stone-800 transition-colors"
                            x-text="t('common.cancel')"
                        >Anuluj</button>
                        <button
                            type="submit"
                            class="bg-pink-400 hover:bg-pink-500 text-white px-5 py-2 rounded-lg text-sm font-medium transition-colors"
                            x-text="t('common.create')"
                        >Utwórz</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function listsPage() {
    return {
        showCreateTemplate: false,
        showCreateFromList: false,

        t(key) {
            // Use the global translation function from app.js
            if (typeof window.getTranslation === 'function') {
                return window.getTranslation(key);
            }
            // Fallback
            const translations = {{toJSON .Translations}};
            const lang = localStorage.getItem('koffan-lang') || '{{.DefaultLang}}';
            const keys = key.split('.');
            let result = translations[lang];
            for (const k of keys) {
                result = result?.[k];
            }
            return result || key;
        },

        init() {
            // Initialize any needed state
        }
    };
}
</script>
{{end}}
